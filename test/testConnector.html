<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<link href="default.css" rel="stylesheet" type="text/css">
<title>---</title>
<style type="text/css">
#canvas {
	border: 1px solid #000;
	box-shadow: 0 1px 5px #777;
}
</style>

<script type="text/Javascript" src="../src/org.xiha.html5.bootstrap.js"></script>
<script type="text/Javascript">
	request('org.xiha.html5.core');
	request('org.xiha.html5.core.node')
	request('org.xiha.html5.core.scene');
	request('org.xiha.html5.core.cube');
	request('org.xiha.html5.core.arccube');
	request('org.xiha.html5.core.actioncube');
	request('org.xiha.html5.core.input.editor');

	request('org.xiha.html5.core.connector');
	request('org.xiha.html5.core.scene.ext');
</script>

</head>

<body>
	<div>
		<canvas id="canvas" width="800" height="600"> </canvas>
	</div>
	<script language="Javascript">
		var canvas = document.getElementById("canvas");
		if (document.width != null) {
			canvas.width = document.width;
		} else {
			canvas.width = window.innerWidth;
		}
		if (document.height != null) {

			canvas.height = document.height;
		} else {
			canvas.height = window.innerHeight;
		}
		var scene = new org.xiha.html5.core.Scene(canvas, 1);
        new org.xiha.html5.core.NodeUtil(40);
        window.org.xiha.html5.core.nodeUtil.minLen = 40;
        window.org.xiha.html5.core.nodeUtil.kPull = 0.02;
        
		var maxnum = 5;

		var rect = {
			x : 200,
			y : 200,
			w : 12,
			h : 12,
			r : 4,
			fillStyle : '#121010',
			clickEnable : true
		};

		var addActionButton = new org.xiha.html5.core.Actioncube(null, rect.w,
				rect.h);
		addActionButton.r = rect.r;
		addActionButton.setFillStyle(rect.fillStyle);
		addActionButton.clickEnable = rect.clickEnable;

		//实现super
		addActionButton.tmp = addActionButton.render;
		addActionButton.render = function() {
			var self = addActionButton;
			if (self.centerPosition != null) {
				addActionButton.tmp();

				var ctx = addActionButton.getContext();
				var x = self.centerPosition.getX();
				var y = self.centerPosition.getY();
				ctx.strokeStyle = "#FFFFFF";
				ctx.lineWidth = 2;

				ctx.moveTo(x, y - (self.h / 2) + 3);
				ctx.lineTo(x, y + (self.h / 2) - 3);

				ctx.stroke();

				ctx.moveTo(x - (self.w / 2) + 3, y);
				ctx.lineTo(x + (self.w / 2) - 3, y);
				ctx.stroke();
			}
			//console.log("do something");
		}
		addActionButton.doClick = function() {
			var e = this.scene.eventPool.getRecentEvent();
			var o = e.object;
			var cube_i = createCube();

			var node_i = new org.xiha.html5.core.Node(cube_i, o, null);

			window.org.xiha.html5.core.nodeUtil
					.ergod(window.org.xiha.html5.core.scene.rootNode);
			window.org.xiha.html5.core.scene.clearScene();
		}
		//circle.enableMoving();

		var cube1 = createCube();
		var cube2 = createCube();
		//var cube3 = createCube();
		//var cube4 = createCube();
		
		//var cube5 = createCube();
		/*
		var cube6 = createCube();

		var cube7 = createCube();
		var cube8 = createCube();
		var cube9 = createCube();
		var cube10 = createCube();
		var cube11 = createCube();
		var cube12 = createCube();
		var cube13 = createCube(); */
		//开始构造结点以及关联关系
		var node = new org.xiha.html5.core.Node(cube1, null, null);
		scene.setRootNode(node);

		new org.xiha.html5.core.Node(cube2, cube1);
		/* new org.xiha.html5.core.Node(cube10, cube2, null);
		new org.xiha.html5.core.Node(cube11, cube2, null);
		new org.xiha.html5.core.Node(cube12, cube2, null);
		new org.xiha.html5.core.Node(cube13, cube2, null); */

		//new org.xiha.html5.core.Node(cube3, cube1);
		//new org.xiha.html5.core.Node(cube4, cube1);
		//new org.xiha.html5.core.Node(cube5, cube1);

		//new org.xiha.html5.core.Node(cube6, cube1, null);
		//new org.xiha.html5.core.Node(cube7, cube6, null);
		//new org.xiha.html5.core.Node(cube8, cube6, null);
		//new org.xiha.html5.core.Node(cube9, cube6, null);

		new org.xiha.html5.core.input.Editor("eee1");

		scene.ready();
		scene.forceBalance(30);
		//scene.gravity(2);
		function createCube() {

			var w = 50;
			var h = w * 0.618;
			var cube = new org.xiha.html5.core.Arccube(null, w, h);
			cube.r = 5;
			cube.setFillStyle('#dbf514');
			cube.clickEnable = true;
			cube.enableMoving();
			cube.addClickAbility();
			cube.editorAble();
			return cube;
		}
	</script>
	<div style="position: absolute" id="eee1" contenteditable="true" />
	<!-- 
		<input id="eee1_input" type="text" value="" />
	</div>
	 -->
</body>
</html>
